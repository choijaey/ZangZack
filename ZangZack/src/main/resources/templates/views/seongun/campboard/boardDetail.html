<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>게시글 상세보기</title>
	<link rel="stylesheet" href="css/seongun/boardDetail.css">
	<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
</head>
<link rel="shortcut icon" href="#">
<body>
	<div th:replace="~{common/navbar :: navbar}"></div>
	<div class="container">
		<div class="article_header">
			<span class="boardCategory">[[${bList.categoryName}]]</span>
			<div class="post-header">
				<h2>[[${bList.cbTitle}]]</h2>
				<div class="post-details">
					<img class="author-profile" th:src="${bList.memberProfilePath}"
						alt="작성자 프로필 이미지" />
					<div class="profile_area">
						<span class="author-name">[[${bList.memberName}]]</span>
						<div class="article_info">
							<span class="post-date">[[${bList.cbCreateDate}]]</span> 
							<span class="post-views">조회수: [[${bList.cbCount}]]</span>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="post-content">
			<p>[[${bList.cbContent}]]</p>
			<th:block th:if="${!pList.isEmpty}">
				<img th:src="${p.photoPath}" alt="게시글 이미지" th:each="p : ${pList}">
			</th:block>
		</div>
		<div class="comments-section">
			<div class="post-details">
				<div class="post-like-comment">
					<img src="image/seongun/offheart.png" alt="좋아요" class="like-button" onclick="increaseLikeCount()"> <span class="like-text">좋아요</span>
					<span class="like-count">[[${bList.heartCount}]]</span> 
					<span class="comment-text">댓글</span>
					<span class="comment-count">[[${bList.replyCount}]]</span>
				</div>
			</div>

			<!-- 댓글 목록 -->
			<div class="comment-box">
				<div id="commentList"></div>
				<h3 class="comment-title">댓글</h3>
				<div class="comment-list"></div>
				<div class="comment-form" th:if="${session.loginUser != null}">
					<textarea class="comment-input" placeholder="댓글을 남겨보세요" id="replyContent"></textarea>
					<button type="button" class="comment-submit" id="insertReply">등록</button>
				</div>
				<div id="pagenation"></div>
			</div>
		</div>
	</div>
	<script th:inline="javascript">
		// 페이지 로드 시 댓글 목록 불러오기
		window.onload = function() {
		    loadCommentList();
		};
	
		// 댓글 목록 불러오는 함수
		/*<![CDATA[*/
		function loadCommentList(replyPage = 1) {
		    $.ajax({
		        url: 'replyLimitList.rep', // 서버의 댓글 목록 불러오기 URL
		        method: 'GET',
		        data: { 
		        	page: replyPage,
		            boardNo: /*[[${bList.cbNo}]]*/1, 
		            boardType: 1 
		        	
		        },
		        success: function(data) {
		            updateCommentList(data.list);
		            updatePagination(data.rPi);
		            console.log(data.rPi);
		        },
		        error: function(error) {
		            console.error('Error loading comments:', error);
		        }
		    });
		}
		/*]]>*/
		
		// 댓글 추가 함수
		/*<![CDATA[*/
		document.getElementById('insertReply').addEventListener('click', function() {
		    const replyContent = document.getElementById('replyContent').value.trim();
		    if (replyContent === '') {
		        alert('댓글을 입력해주세요!');
		        return;
		    }
	
		    $.ajax({
		        url: 'insertReply.rep',
		        method: 'POST',
		        data: {
		            replyContent: replyContent,
		            boardNo: /*[[${bList.cbNo}]]*/1, // 예시로 1을 사용, 실제로는 동적으로 설정해야 함
		            boardType: 1 
		        },
		        success: function(data) {
		            loadCommentList();
		            document.getElementById('replyContent').value = '';
		        },
		        error: function(error) {
		            console.error('Error adding comment:', error);
		        }
		    });
		});
		/*]]>*/

		function formatDate(dateString) {
		    const date = new Date(dateString);
		    return date.getFullYear() + '-' + 
		           (date.getMonth() + 1).toString().padStart(2, '0') + '-' + 
		           date.getDate().toString().padStart(2, '0') + ' ' + 
		           date.getHours().toString().padStart(2, '0') + ':' + 
		           date.getMinutes().toString().padStart(2, '0');
		}

	</script>
</body>
</html>
